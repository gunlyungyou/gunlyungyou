---
layout: single
title:  "Churn Prediction Using Vision Transformer"
categories:
  - Classification
toc: true
toc_sticky: true
toc_label: "Contents"
excerpt: "Vision Transformer를 이용해 고객들의 서비스 이탈을 예측하는 모델을 만든 프로젝트에 대한 소개 페이지 입니다."
header:
  overlay_image: /assets/images/churn.png
  overlay_filter: 0.5 # same as adding an opacity of 0.5 to a black background
  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
  # actions:
  #   - label: "More Info"
  #     url: "https://unsplash.com"
  
---


    

# Vision Transformer를 이용한 실시간 고객 이탈 예측 모델

## why?

1.Sequence 데이터 이용의 필요성

기존에 저희 조직에서 주로 개발되었던 이탈 모델은 특정 기간 동안 유저들의 접속, 과금, 플레이 패턴 등의 정보를 요약해서 피쳐로 이용하였습니다.
예를 들어서 3개월 동안 어떤 유저의 총 접속 횟수나 평균 플레이타임 등의 정보를 이용해서 해당 유저가 이탈할지 예측하는 모델을 주로 만들었습니다.

하지만 서비스 이탈위험이 있는 유저는 보통 이탈에 가까운 시점에 접속 주기가 점점 길어진다던지, 과금을 점점 줄인다던지, 일일 퀘스트를 완료하지 않는다던지 등의 신호를 보냅니다.
이 때, 특정 기간 동안의 요약 정보를 이용하면 이러한 신호를 잡아낼 수가 없습니다.
그렇기 때문에 요약 정보 대신 아래의 그림처럼 특정 기간동안의 유저의 정보를 전부 모델에 입력하면 유저가 보내는 이탈 신호를 감지할 수 있게 되고, 
이런 신호를 보내는 유저들에게 적절한 마케팅을 한다면 그렇지 않은 유저에 비해 더 긴 리텐션을 확보할 수 있습니다.


(이미지)

2.실시간, 개인화 이탈 예측 모델의 필요성

기존의 모델은 특정 유저의 이탈 확률만을 예측할 뿐 이 유저가 "언제" 이탈할지에 대한 정보는 제공해주지 않고 있습니다. 또한, ML모델의 feautre importance를 통해
이탈에 대한 원인을 추정해볼 수는 있지만 적절한 시기에 적절한 원인을 감지해내기는 어렵습니다.

이러한 한계를 극복하기 위해 특정 기간의 유저 정보를 이미지처럼 활용하여 아래처럼 Attention Mechanism을 적용하면 유저가 언제, 어떠한 이유로 이탈하는 지 감지하여 적절한 시기에 적절한 마케팅을 실시할 수 있게 됩니다. 

(이미지)

Attention Mechanism을 이용하면 이미지에서 모델이 어떤 부분을 보고 Y label이라고 예측했는지에 대한 정보를 알 수 있습니다. 
이를 x축은 시간, y축은 feauture인 Sequence 이미지에 적용하면 언제, 어떤 이유로 유저가 이탈할 것인지에 대한 힌트를 얻을 수 있습니다.


## How?

### Data Preprocesing

1.서비스 선정

실시간, 개인화 이탈 모델을 만들고 유저들의 리텐션을 늘리기 위한 마케팅을 진행하기 위해서는, 서비스 외부적인 요소보다는 인게임 요소로 인한 이탈이 많은 서비스가 적당하다고 생각했습니다.
따라서 한판, 한판 단발성의 플레이 패턴을 보이는 서비스보다는 RPG 서비스처럼 복귀나 신규 가입을 했을 때 긴 호흡을 갖고 플레이하는 서비스가 적합하였고,
현재 유저 이탈이 전년 대비 가속화되고 있는 서비스를 선택하여 이에 대한 부양책으로 마케팅을 직접 진행하는 것이 더 많은 필요를 느낄 것이라고 생각하여 현재 넥슨에서 서비스하고 있는 RPG 서비스 중 하나를 선택하였습니다.

2.Label 설정

Y label의 설정은 과제의 난이도를 결정짓고 해당 모델이 얼마나 현실에서 쓰임새가 있는지 결정하게 되는 중요한 부분입니다. 따라서, 최대한 실제 사업부에서 납득하고 바로 마케팅에 이용할 수 있을만한 기준으로 만들었습니다.

* 이탈: 서비스에 연속으로 미접속한 기간이 9일 이상, 17일 미만인 경우
* 잔존: 서비스에 연속으로 미접속한 기간이 9일 미만인 경우

저희 팀 내부에서는 특정 서비스 연속 미접속 기간이 9일 이상인 유저들을 이탈 유저로 정의하고 있습니다. 이는 복귀나 신규 가입한 유저들의 95%가 9일동안 미접속하면 다시 서비스에 돌아오지 않고 장기 이탈로 이어지기 떄문입니다. 또한, 현재 게임을 즐기고 있는 유저인 액티브 유저들은 연속 미접속 기간이 9일 이내이기 때문에 해당 유저들이 일주일 이내에 이탈할 것을 예측하기 위해서는 연속 미접속 기간이 17일 미만인 경우로 설정하였습니다.

예를 들면 데이터 추츨 시점에 어떤 유저가 연속 미접속 기간이 4일인 경우 이 유저는 정의상 아직 액티브 유저이지만 일주일 후에 연속 미접속 기간이 11일이면 이 유저는 데이터 추출 시점에 이탈 유저인 것으로 모델에게 입력되게 됩니다.

3.데이터 준비

데이터는 추출 시점에 액티브 유저 즉, 연속 미접속 기간이 9일 이하인 모든 유저들을 대상으로 하였습니다. 해당 유저들을 바탕으로 일주일 이내에 서비스를 이탈할 것 같은 유저들을 예측하는 것이 목표입니다.
이탈을 예측에 사용할 피쳐는 다음과 같습니다.

* 접속 시간, 접속 횟수, 접속 주기 등 플레이 패턴과 관련된 변수 7종
* 아이템 강화, 몬스터 사냥, 외형 아이템 변경 등의 인게임 요소 73종

데이터는 약 4개월 동안의 일별 접속과 로그 정보를 Sequence 이미지로 표현하였습니다. 따라서, 한 유저당 120*80 사이즈의 행렬이 생성이 되며 이를 channel이 1인 이미지처럼 활용하였습니다.
이용한 데이터는 수만 건으로 이 중에서 20%를 testset으로 이용하였습니다.

hyperparameter tuning?
validation?
correlation?
normalization?

### Modeling

모델은 Vision Transformer를 이용하였습니다. 


### Result





